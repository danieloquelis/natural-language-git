#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."

# Run tests
echo "Running tests..."
yarn test 2>&1 | grep -E "Test Suites:|Tests:"
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Push aborted."
  exit 1
fi
echo "âœ… Tests passed"

# Run linter
echo "Running linter..."
yarn lint
if [ $? -ne 0 ]; then
  echo "âš ï¸  Linter found issues. Attempting to fix..."
  yarn lint:fix

  # Check if there are any changes after fixing
  if ! git diff --quiet; then
    echo "âœ… Linter fixes applied"
    echo "ğŸ“ Please review the changes, stage them, and commit:"
    echo "   git add ."
    echo "   git commit --amend --no-edit"
    echo "âŒ Push aborted - please commit linter fixes first"
    exit 1
  else
    echo "âœ… All linter issues resolved"
  fi
fi
echo "âœ… Linter passed"

echo "âœ¨ All pre-push checks passed!"
exit 0
